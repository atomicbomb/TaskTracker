<Window x:Class="TaskTracker.Views.TaskPromptWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:System="clr-namespace:System;assembly=mscorlib"
        xmlns:local="clr-namespace:TaskTracker.Views"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="350" 
        Width="500"
        MinHeight="300" 
        MinWidth="450"
        Background="White"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Topmost="True"
        ShowInTaskbar="False">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <local:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <local:LunchModeToTextConverter x:Key="LunchModeToTextConverter"/>
    <BooleanToVisibilityConverter x:Key="ManualBoolToVisibility"/>
        
        <!-- Simple color brushes -->
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="Black"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="Gray"/>
        <SolidColorBrush x:Key="TextTertiaryBrush" Color="DarkGray"/>
        
        <!-- Simple button styles -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="DodgerBlue"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style x:Key="SecondaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   FontSize="18" 
                   FontWeight="Bold" 
                   Margin="0,0,0,20"
                   Foreground="Black"
                   HorizontalAlignment="Center">
            <TextBlock.Text>
                <MultiBinding StringFormat="What are you working on? - {0:HH:mm}">
                    <Binding Source="{x:Static System:DateTime.Now}" />
                </MultiBinding>
            </TextBlock.Text>
        </TextBlock>
        
        <!-- Content -->
        <Grid Grid.Row="1">
            
        <!-- Normal/Manual Task Selection Mode -->
        <Grid Visibility="{Binding IsLunchMode, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
            <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" Text="Project:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <ComboBox Grid.Row="0" 
                          ItemsSource="{Binding Projects}"
                          SelectedItem="{Binding SelectedProject}"
                          IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                          Margin="0,20,0,0">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding ProjectCode}" FontWeight="SemiBold" Width="80"/>
                                <TextBlock Text="-" Margin="5,0"/>
                                <TextBlock Text="{Binding ProjectName}" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                
                <TextBlock Grid.Row="2" Text="Task:" FontWeight="SemiBold" Margin="0,0,0,5"
                           Visibility="{Binding IsManualMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                <ComboBox Grid.Row="2" 
                          ItemsSource="{Binding Tasks}"
                          SelectedItem="{Binding SelectedTask}"
                          IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                          Margin="0,20,0,0"
                          Visibility="{Binding IsManualMode, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding JiraTaskNumber}" FontWeight="SemiBold" Width="100"/>
                                <TextBlock Text="-" Margin="5,0"/>
                                <TextBlock Text="{Binding Summary}" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Manual Mode Inputs -->
                <TextBlock Grid.Row="2" Text="Manual Summary:" FontWeight="SemiBold" Margin="0,0,0,5"
                           Visibility="{Binding IsManualMode, Converter={StaticResource ManualBoolToVisibility}}"/>
                <TextBox Grid.Row="2" Text="{Binding ManualSummary, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,20,0,0"
                         Visibility="{Binding IsManualMode, Converter={StaticResource ManualBoolToVisibility}}"/>
                
                <!-- Loading Indicator -->
                <StackPanel Grid.Row="4" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Center"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ProgressBar IsIndeterminate="True" Width="150" Height="15" Margin="0,0,10,0"/>
                    <TextBlock Text="Loading..." VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>
                
                <!-- Help Text -->
                <TextBlock Grid.Row="6" 
                           Text="Select the same task if you're continuing previous work, or choose a different task to switch."
                           TextWrapping="Wrap"
                           Foreground="{StaticResource TextTertiaryBrush}"
                           FontSize="12"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"
                           Margin="0,10,0,0"/>
            </Grid>
            
            <!-- Lunch Break Mode -->
            <Grid Visibility="{Binding IsLunchMode, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" 
                           Text="ðŸ½ï¸ Taking a lunch break" 
                           FontSize="16"
                           HorizontalAlignment="Center"
                           Foreground="{StaticResource TextPrimaryBrush}"/>
                
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="Duration:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBox Text="{Binding LunchDuration, UpdateSourceTrigger=PropertyChanged}" Width="60" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <TextBlock Text="minutes" VerticalAlignment="Center" Margin="10,0,0,0"/>
                </StackPanel>
                
                <TextBlock Grid.Row="4" 
                           Text="Your current task will be paused and you won't be prompted again until lunch is over."
                           TextWrapping="Wrap"
                           Foreground="{StaticResource TextTertiaryBrush}"
                           FontSize="12"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"/>
            </Grid>
        </Grid>
        
        <!-- Buttons -->
        <Grid Grid.Row="2" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
        <Button Grid.Column="0" 
            Content="{Binding IsLunchMode, Converter={StaticResource LunchModeToTextConverter}}" 
                    Style="{StaticResource SecondaryButtonStyle}"
                    Command="{Binding LunchCommand}"
                    HorizontalAlignment="Left"
                    Width="100"
                    Visibility="{Binding IsLunchMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>

        <Button Grid.Column="0"
            Content="Manual Mode"
            Style="{StaticResource SecondaryButtonStyle}"
            Command="{Binding ManualModeCommand}"
            HorizontalAlignment="Left"
            Width="110"
            Margin="110,0,0,0"
            Visibility="{Binding IsLunchMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
            
            <Button Grid.Column="1" 
                    Content="Confirm" 
                    Style="{StaticResource PrimaryButtonStyle}"
                    Command="{Binding ConfirmCommand}"
                    IsDefault="True"
                    Width="80"
                    Margin="0,0,10,0"/>
            
            <Button Grid.Column="2" 
                    Content="Cancel" 
                    Style="{StaticResource SecondaryButtonStyle}"
                    Command="{Binding CancelCommand}"
                    Width="80"/>
        </Grid>
    </Grid>
</Window>
